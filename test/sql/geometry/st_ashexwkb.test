require spatial

# Standard WKB
query I
SELECT ST_AsHEXWKB(ST_GeomFromText('POLYGON ((0 0, 0 1, 1 1, 1 0, 0 0))'));
----
01030000000100000005000000000000000000000000000000000000000000000000000000000000000000F03F000000000000F03F000000000000F03F000000000000F03F000000000000000000000000000000000000000000000000

# Standard WKB roundtrip
query I
SELECT ST_GeomFromHEXWKB(ST_AsHEXWKB(ST_GeomFromText('POLYGON ((0 0, 0 1, 1 1, 1 0, 0 0))')));
----
POLYGON ((0 0, 0 1, 1 1, 1 0, 0 0))

# Extended WKB
query I
SELECT ST_GeomFROMHEXWKB('0103000020FB0B000001000000040000003A0D9D1BD96A2041DD7785E876C8594104540619C66A2041BB3961E381C85941D9FE2983826A2041E0BCADCA81C859413A0D9D1BD96A2041DD7785E876C85941');
----
POLYGON ((537964.5539325841 6758875.633146253, 537955.0488764052 6758919.552809174, 537921.2561797752 6758919.166854113, 537964.5539325841 6758875.633146253))

# Extended WKB with Z
query I
SELECT ST_GeomFROMHEXWKB('0103000080010000000500000000000000000000000000000000000000000000000000F03F0000000000000000000000000000F03F000000000000F03F000000000000F03F000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F00000000000000000000000000000000000000000000F03F');
----
POLYGON Z ((0 0 1, 0 1 1, 1 1 1, 1 0 1, 0 0 1))

# Extended WKB with M
query I
SELECT ST_GeomFROMHEXWKB('0103000040010000000500000000000000000000000000000000000000000000000000F03F0000000000000000000000000000F03F000000000000F03F000000000000F03F000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F00000000000000000000000000000000000000000000F03F');
----
POLYGON M ((0 0 1, 0 1 1, 1 1 1, 1 0 1, 0 0 1))

# Extended WKB with Z M
query I
SELECT ST_GeomFROMHEXWKB('01030000C0010000000500000000000000000000000000000000000000000000000000F03F000000000000F03F0000000000000000000000000000F03F000000000000F03F0000000000000040000000000000F03F000000000000F03F000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000104000000000000000000000000000000000000000000000F03F0000000000001440');
----
POLYGON ZM ((0 0 1 1, 0 1 1 2, 1 1 1 3, 1 0 1 4, 0 0 1 5))

# Test rountrips properly
statement ok
CREATE TABLE types (geom GEOMETRY);

statement ok
INSERT INTO types VALUES
    (ST_GeomFromText('POINT EMPTY')),
    (ST_GeomFromText('POINT(0 0)')),
    (ST_GeomFromText('LINESTRING EMPTY')),
    (ST_GeomFromText('LINESTRING(0 0, 1 1)')),
    (ST_GeomFromText('POLYGON EMPTY')),
    (ST_GeomFromText('POLYGON((0 0, 1 0, 1 1, 0 1, 0 0))')),
    (ST_GeomFromText('MULTIPOINT EMPTY')),
    (ST_GeomFromText('MULTIPOINT(0 0, 1 1)')),
    (ST_GeomFromText('MULTILINESTRING EMPTY')),
    (ST_GeomFromText('MULTILINESTRING((0 0, 1 1), (2 2, 3 3))')),
    (ST_GeomFromText('MULTIPOLYGON EMPTY')),
    (ST_GeomFromText('MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((2 2, 3 2, 3 3, 2 3, 2 2)))')),
    (ST_GeomFromText('GEOMETRYCOLLECTION EMPTY')),
    (ST_GeomFromText('GEOMETRYCOLLECTION(POINT(0 0), LINESTRING(0 0, 1 1))'));

query I
SELECT ST_AsText(ST_GeomFromHEXWKB(ST_AsHEXWKB(geom))) FROM types;
----
POINT EMPTY
POINT (0 0)
LINESTRING EMPTY
LINESTRING (0 0, 1 1)
POLYGON EMPTY
POLYGON ((0 0, 1 0, 1 1, 0 1, 0 0))
MULTIPOINT EMPTY
MULTIPOINT (0 0, 1 1)
MULTILINESTRING EMPTY
MULTILINESTRING ((0 0, 1 1), (2 2, 3 3))
MULTIPOLYGON EMPTY
MULTIPOLYGON (((0 0, 1 0, 1 1, 0 1, 0 0)), ((2 2, 3 2, 3 3, 2 3, 2 2)))
GEOMETRYCOLLECTION EMPTY
GEOMETRYCOLLECTION (POINT (0 0), LINESTRING (0 0, 1 1))