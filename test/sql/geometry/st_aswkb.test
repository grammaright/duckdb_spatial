require spatial

# Test ST_AsWKB -> ST_GeomFromWKB roundtrip for geometry types
statement ok
CREATE TABLE types (geom GEOMETRY);

statement ok
INSERT INTO types VALUES
    (ST_GeomFromText('POINT EMPTY')),
    (ST_GeomFromText('POINT(0 0)')),
    (ST_GeomFromText('LINESTRING EMPTY')),
    (ST_GeomFromText('LINESTRING(0 0, 1 1)')),
    (ST_GeomFromText('POLYGON EMPTY')),
    (ST_GeomFromText('POLYGON((0 0, 1 0, 1 1, 0 1, 0 0))')),
    (ST_GeomFromText('MULTIPOINT EMPTY')),
    (ST_GeomFromText('MULTIPOINT(0 0, 1 1)')),
    (ST_GeomFromText('MULTILINESTRING EMPTY')),
    (ST_GeomFromText('MULTILINESTRING((0 0, 1 1), (2 2, 3 3))')),
    (ST_GeomFromText('MULTIPOLYGON EMPTY')),
    (ST_GeomFromText('MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((2 2, 3 2, 3 3, 2 3, 2 2)))')),
    (ST_GeomFromText('GEOMETRYCOLLECTION EMPTY')),
    (ST_GeomFromText('GEOMETRYCOLLECTION(POINT(0 0), LINESTRING(0 0, 1 1))'));

query I
SELECT ST_AsText(ST_GeomFromWKB(ST_AsWKB(geom))) FROM types
----
POINT EMPTY
POINT (0 0)
LINESTRING EMPTY
LINESTRING (0 0, 1 1)
POLYGON EMPTY
POLYGON ((0 0, 1 0, 1 1, 0 1, 0 0))
MULTIPOINT EMPTY
MULTIPOINT (0 0, 1 1)
MULTILINESTRING EMPTY
MULTILINESTRING ((0 0, 1 1), (2 2, 3 3))
MULTIPOLYGON EMPTY
MULTIPOLYGON (((0 0, 1 0, 1 1, 0 1, 0 0)), ((2 2, 3 2, 3 3, 2 3, 2 2)))
GEOMETRYCOLLECTION EMPTY
GEOMETRYCOLLECTION (POINT (0 0), LINESTRING (0 0, 1 1))

# With Z
statement ok
CREATE TABLE types_z (geom GEOMETRY);

statement ok
INSERT INTO types_z VALUES
	(ST_GeomFromText('POINT Z EMPTY')),
	(ST_GeomFromText('POINT Z(0 0 0)')),
	(ST_GeomFromText('LINESTRING Z EMPTY')),
	(ST_GeomFromText('LINESTRING Z(0 0 0, 1 1 1)')),
	(ST_GeomFromText('POLYGON Z EMPTY')),
	(ST_GeomFromText('POLYGON Z((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0))')),
	(ST_GeomFromText('MULTIPOINT Z EMPTY')),
	(ST_GeomFromText('MULTIPOINT Z(0 0 0, 1 1 1)')),
	(ST_GeomFromText('MULTILINESTRING Z EMPTY')),
	(ST_GeomFromText('MULTILINESTRING Z((0 0 0, 1 1 1), (2 2 2, 3 3 3))')),
	(ST_GeomFromText('MULTIPOLYGON Z EMPTY')),
	(ST_GeomFromText('MULTIPOLYGON Z(((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0)), ((2 2 2, 3 2 2, 3 3 2, 2 3 2, 2 2 2)))')),
	(ST_GeomFromText('GEOMETRYCOLLECTION Z EMPTY')),
	(ST_GeomFromText('GEOMETRYCOLLECTION Z(POINT Z(0 0 0), LINESTRING Z(0 0 0, 1 1 1))'));


query I
SELECT ST_AsText(ST_GeomFromWKB(ST_AsWKB(geom))) FROM types_z
----
POINT Z EMPTY
POINT Z (0 0 0)
LINESTRING Z EMPTY
LINESTRING Z (0 0 0, 1 1 1)
POLYGON Z EMPTY
POLYGON Z ((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0))
MULTIPOINT Z EMPTY
MULTIPOINT Z (0 0 0, 1 1 1)
MULTILINESTRING Z EMPTY
MULTILINESTRING Z ((0 0 0, 1 1 1), (2 2 2, 3 3 3))
MULTIPOLYGON Z EMPTY
MULTIPOLYGON Z (((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0)), ((2 2 2, 3 2 2, 3 3 2, 2 3 2, 2 2 2)))
GEOMETRYCOLLECTION Z EMPTY
GEOMETRYCOLLECTION Z (POINT Z (0 0 0), LINESTRING Z (0 0 0, 1 1 1))

# With M
statement ok
CREATE TABLE types_m (geom GEOMETRY);

statement ok
INSERT INTO types_m VALUES
	(ST_GeomFromText('POINT M EMPTY')),
	(ST_GeomFromText('POINT M(0 0 0)')),
	(ST_GeomFromText('LINESTRING M EMPTY')),
	(ST_GeomFromText('LINESTRING M(0 0 0, 1 1 1)')),
	(ST_GeomFromText('POLYGON M EMPTY')),
	(ST_GeomFromText('POLYGON M((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0))')),
	(ST_GeomFromText('MULTIPOINT M EMPTY')),
	(ST_GeomFromText('MULTIPOINT M(0 0 0, 1 1 1)')),
	(ST_GeomFromText('MULTILINESTRING M EMPTY')),
	(ST_GeomFromText('MULTILINESTRING M((0 0 0, 1 1 1), (2 2 2, 3 3 3))')),
	(ST_GeomFromText('MULTIPOLYGON M EMPTY')),
	(ST_GeomFromText('MULTIPOLYGON M(((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0)), ((2 2 2, 3 2 2, 3 3 2, 2 3 2, 2 2 2)))')),
	(ST_GeomFromText('GEOMETRYCOLLECTION M EMPTY')),
	(ST_GeomFromText('GEOMETRYCOLLECTION M(POINT M(0 0 0), LINESTRING M(0 0 0, 1 1 1))'));

query I
SELECT ST_AsText(ST_GeomFromWKB(ST_AsWKB(geom))) FROM types_m
----
POINT M EMPTY
POINT M (0 0 0)
LINESTRING M EMPTY
LINESTRING M (0 0 0, 1 1 1)
POLYGON M EMPTY
POLYGON M ((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0))
MULTIPOINT M EMPTY
MULTIPOINT M (0 0 0, 1 1 1)
MULTILINESTRING M EMPTY
MULTILINESTRING M ((0 0 0, 1 1 1), (2 2 2, 3 3 3))
MULTIPOLYGON M EMPTY
MULTIPOLYGON M (((0 0 0, 1 0 0, 1 1 0, 0 1 0, 0 0 0)), ((2 2 2, 3 2 2, 3 3 2, 2 3 2, 2 2 2)))
GEOMETRYCOLLECTION M EMPTY
GEOMETRYCOLLECTION M (POINT M (0 0 0), LINESTRING M (0 0 0, 1 1 1))

# With ZM
statement ok
CREATE TABLE types_zm (geom GEOMETRY);

statement ok
INSERT INTO types_zm VALUES
	(ST_GeomFromText('POINT ZM EMPTY')),
	(ST_GeomFromText('POINT ZM(0 0 0 0)')),
	(ST_GeomFromText('LINESTRING ZM EMPTY')),
	(ST_GeomFromText('LINESTRING ZM(0 0 0 0, 1 1 1 1)')),
	(ST_GeomFromText('POLYGON ZM EMPTY')),
	(ST_GeomFromText('POLYGON ZM((0 0 0 0, 1 0 0 0, 1 1 0 0, 0 1 0 0, 0 0 0 0))')),
	(ST_GeomFromText('MULTIPOINT ZM EMPTY')),
	(ST_GeomFromText('MULTIPOINT ZM(0 0 0 0, 1 1 1 1)')),
	(ST_GeomFromText('MULTILINESTRING ZM EMPTY')),
	(ST_GeomFromText('MULTILINESTRING ZM((0 0 0 0, 1 1 1 1), (2 2 2 2, 3 3 3 3))')),
	(ST_GeomFromText('MULTIPOLYGON ZM EMPTY')),
	(ST_GeomFromText('MULTIPOLYGON ZM(((0 0 0 0, 1 0 0 0, 1 1 0 0, 0 1 0 0, 0 0 0 0)), ((2 2 2 2, 3 2 2 2, 3 3 2 2, 2 3 2 2, 2 2 2 2)))')),
	(ST_GeomFromText('GEOMETRYCOLLECTION ZM EMPTY')),
	(ST_GeomFromText('GEOMETRYCOLLECTION ZM(POINT ZM(0 0 0 0), LINESTRING ZM(0 0 0 0, 1 1 1 1))'));

query I
SELECT ST_AsText(ST_GeomFromWKB(ST_AsWKB(geom))) FROM types_zm
----
POINT ZM EMPTY
POINT ZM (0 0 0 0)
LINESTRING ZM EMPTY
LINESTRING ZM (0 0 0 0, 1 1 1 1)
POLYGON ZM EMPTY
POLYGON ZM ((0 0 0 0, 1 0 0 0, 1 1 0 0, 0 1 0 0, 0 0 0 0))
MULTIPOINT ZM EMPTY
MULTIPOINT ZM (0 0 0 0, 1 1 1 1)
MULTILINESTRING ZM EMPTY
MULTILINESTRING ZM ((0 0 0 0, 1 1 1 1), (2 2 2 2, 3 3 3 3))
MULTIPOLYGON ZM EMPTY
MULTIPOLYGON ZM (((0 0 0 0, 1 0 0 0, 1 1 0 0, 0 1 0 0, 0 0 0 0)), ((2 2 2 2, 3 2 2 2, 3 3 2 2, 2 3 2 2, 2 2 2 2)))
GEOMETRYCOLLECTION ZM EMPTY
GEOMETRYCOLLECTION ZM (POINT ZM (0 0 0 0), LINESTRING ZM (0 0 0 0, 1 1 1 1))
